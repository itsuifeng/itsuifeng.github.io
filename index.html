<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sanly&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录生活、工作、日志">
<meta property="og:type" content="website">
<meta property="og:title" content="Sanly's Blog">
<meta property="og:url" content="https://itsuifeng.github.io/index.html">
<meta property="og:site_name" content="Sanly's Blog">
<meta property="og:description" content="记录生活、工作、日志">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sanly's Blog">
<meta name="twitter:description" content="记录生活、工作、日志">
  
    <link rel="alternative" href="/atom.xml" title="Sanly&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="http://itsuifeng.github.io/img/head.png" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Sanly</a></h1>
		</hgroup>

		
		<p class="header-subtitle">单身程序员一枚</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/itsuifeng/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="mail" target="_blank" href="mailto:itsuifeng@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/操作系统/" style="font-size: 10px;">操作系统</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://wsgzao.github.io/">Hello Dog</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.oschina.net/">开源中国</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://itsuifeng.github.io/">Sanly&#39;s Blog</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.zybuluo.com/mdeditor">markdwon在线</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.itechzero.com/google-mirror-sites-collect.html">谷歌镜像站</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.javaspecialists.eu/">javaspeciallist</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://itindex.net/">IT瘾</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://stackoverflow.com/">stackoverflow</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mysqlblog.fivefarmers.com/">Todd&#39;s MySQL</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">程序员一枚，熟悉Java语言，却从事着数据库的管理、优化工作，目前维护公司两款国产数据库及开源MySQL数据库性能优化，持续关注新兴互联网技术…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Sanly</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://itsuifeng.github.io/img/head.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Sanly</h1>
			</hgroup>
			
			<p class="header-subtitle">单身程序员一枚</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/itsuifeng/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="mail" target="_blank" href="mailto:itsuifeng@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-国产化之-龙芯CPU上趟过的坑" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/08/国产化之-龙芯CPU上趟过的坑/" class="article-date">
  	<time datetime="2015-06-08T15:45:30.000Z" itemprop="datePublished">2015-06-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/08/国产化之-龙芯CPU上趟过的坑/">国产化之-龙芯CPU上趟过的坑</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://www.loongson.cn/images/BANNER3.jpg" alt="龙芯"></p>
<hr>
<p>最近公司一直忙于将两个安全产品迁移部署到国产操作系统、国产数据库上，整个迁移过程，趟坑无数，依然存在许多问题亟需解决。龙芯为支持Java，针对OpenJDK（不是Oracle JDK）做了部分了修改，导致应用部署上去出现很多兼容性问题。</p>
<hr>
<ul>
<li>jdk1.8的版本，swing组件花屏；</li>
<li>麦克风录音时，直接抛异常（还好其中部分jdk1.6版本不存在此问题）；</li>
<li>Apache Derby数据库打开时，因无法读取数据库日志文件抛异常；</li>
<li>jdk1.7版本在龙芯CPU上完全是鸡肋，整个应用跑起来非常吃力，吐血的慢，而应用基于Oracle jdk1.7版本编译，无法在jdk1.6运行，不得不重新编译到1.6版本；</li>
<li>后续持续问题…</li>
</ul>
<hr>
<p><strong>感受：</strong> </p>
<blockquote>
<p>国产化道路任重而道远<br>革命尚未成功，同志仍需努力<br>路漫漫其修远兮，吾将上下而求索</p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/操作系统/">操作系统</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-工欲善其事，必先利其器之-MySQL优化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/08/工欲善其事，必先利其器之-MySQL优化/" class="article-date">
  	<time datetime="2015-06-08T12:39:21.000Z" itemprop="datePublished">2015-06-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/08/工欲善其事，必先利其器之-MySQL优化/">MySQL优化之-工欲善其事，必先利其器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>一开始从开发转数据库，觉得写SQL很简单？后来认识到too young too simple, sometimes naive. 正所谓：“查询容易，优化难，难于上青天。。。”，不过依然可以借助一些辅助工具逐渐入门，记录一些优化方式及心得。</p>
<hr>
<ol>
<li>优化不能漫无目的，海中捞针，自己累不说，工作也没有成效，应结合业务找出性能较差的SQL，一步一步的解决；</li>
<li>I/O访问永远是数据库性能开销的突出地方，应尽量避免多次I/O访问，也是优化最有效果的地方。（磁盘读取数据靠机械运动，每次读取数据花费的时间包括寻道时间、旋转延迟、传输时间，寻道是磁臂移动到指定磁道所需要的时间，旋转延迟指磁盘转速，传输时间指从磁盘读出或写入磁盘的时间）；</li>
<li>结合MySQL的查询分析器（explain、profile）慢日志分析工具，反复查看执行计划，新增、修改索引，不断优化SQL；</li>
</ol>
<hr>
<h6 id="以下是自己写的一些SQL工具：">以下是自己写的一些SQL工具：</h6><p>— 查看某表、某列的区分度情况<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> column_name) <span class="keyword">AS</span> <span class="string">'不重复记录数'</span>,</span><br><span class="line">	<span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="string">'总记录数'</span>,</span><br><span class="line">	<span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> column_name) / <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="string">'区分度'</span>,</span><br><span class="line">	<span class="keyword">COUNT</span>(*) / <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> column_name) <span class="keyword">AS</span> <span class="string">'检索次数'</span></span><br><span class="line"><span class="keyword">FROM</span> table_name</span></span><br></pre></td></tr></table></figure></p>
<p> — (查询系统表，利用列转行）计算QPS、TPS<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(Questions) / <span class="keyword">SUM</span>(Uptime) <span class="keyword">AS</span> <span class="string">'QPS'</span>,</span><br><span class="line">	(<span class="keyword">SUM</span>(Com_commit) + <span class="keyword">SUM</span>(Com_rollback)) / <span class="keyword">SUM</span>(Uptime) <span class="keyword">AS</span> <span class="string">'TPS'</span></span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="keyword">CASE</span> VARIABLE_NAME <span class="keyword">WHEN</span> <span class="string">'Questions'</span> <span class="keyword">THEN</span> VARIABLE_VALUE <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'Questions'</span>,</span><br><span class="line">		<span class="keyword">CASE</span> VARIABLE_NAME <span class="keyword">WHEN</span> <span class="string">'Uptime'</span> 	<span class="keyword">THEN</span> VARIABLE_VALUE <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'Uptime'</span>,</span><br><span class="line">		<span class="keyword">CASE</span> VARIABLE_NAME <span class="keyword">WHEN</span> <span class="string">'Com_commit'</span> <span class="keyword">THEN</span> VARIABLE_VALUE <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'Com_commit'</span>,</span><br><span class="line">		<span class="keyword">CASE</span> VARIABLE_NAME <span class="keyword">WHEN</span> <span class="string">'Com_rollback'</span> <span class="keyword">THEN</span> VARIABLE_VALUE <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">'Com_rollback'</span></span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		information_schema.GLOBAL_STATUS</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		VARIABLE_NAME <span class="keyword">IN</span> (<span class="string">'Questions'</span>, <span class="string">'Uptime'</span>, <span class="string">'Com_commit'</span>, <span class="string">'Com_rollback'</span>)</span><br><span class="line">) <span class="keyword">AS</span> tmp</span></span><br></pre></td></tr></table></figure></p>
<p>— 禁止MySQL缓存hack（通过在查询结果集加入时间，避免查询时使用缓存，影响性能分析）<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> t.*, <span class="keyword">now</span>() <span class="keyword">FROM</span> rental t</span></span><br></pre></td></tr></table></figure></p>
<p>— 禁止MySQL缓存，根据数据库版本，有些时候不灵光<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">BEGIN</span>;</span></span><br><span class="line">	<span class="operator"><span class="keyword">RESET</span> <span class="keyword">QUERY</span> <span class="keyword">CACHE</span>;</span></span><br><span class="line">	<span class="operator"><span class="keyword">SELECT</span> <span class="keyword">SQL_NO_CACHE</span> t.* <span class="keyword">FROM</span> rental t ;</span></span><br><span class="line"><span class="operator"><span class="keyword">END</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>— 强制使用指定的某个索引<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> t.* <span class="keyword">FROM</span> rental t <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (index_update_time) </span><br><span class="line">	<span class="keyword">WHERE</span> type = <span class="number">2</span> <span class="keyword">AND</span> update_time &gt; <span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> update_time <span class="keyword">DESC</span>;</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-Java利器之-多输出流MutiOutputStream" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/07/Java利器之-多输出流MutiOutputStream/" class="article-date">
  	<time datetime="2015-06-07T06:46:18.000Z" itemprop="datePublished">2015-06-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/07/Java利器之-多输出流MutiOutputStream/">Java利器之-多输出流MutiOutputStream</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>一些情况下，我希望I/O流能够一次性写入到任何输出流，比如网络、磁盘、管道、缓存、控制台、swing组件等，但是我不愿意重复写复制流的代码，于是多输出流MutiOutputStream应运而生；</p>
<hr>
<p><strong>应用场景:</strong> 首先我们看一下多输出流的应用场景，我在公司工作时遇到这样一个现实场景，底层框架catch了一个异常，这个异常通过调用<code>e.printStackTrace()</code>方法直接打印到控制台；逻辑层根本无法捕获这个异常，但是现实情况是我必须拿到这个异常，通过业务逻辑重新处理这个异常。也许看到这里很多朋友，会对此呲之以鼻，觉得这个异常是底层框架没有处理好，既然业务层需要处理这个异常，设计框架时应该将这个异常抛出，由义务层捕获并处理。不过于我而言，其实我给框架的作者进行了多次交流，但是框架的作者不希望抛出此异常，因此十分无奈，正所谓道高一尺、魔高一丈。既然无法说服别人，就要用不寻常的方式解决这个问题；</p>
<hr>
<p><strong>处理方案：</strong> 方案很简单，因为是偏方所以不建议大家这样做，遇到这样的问题还是最好多沟通，尽量由底层解决。我们知道<code>e.printStackTrace()</code>方法会将错误输出流定向到System.err流中，因此我将System.err输出流定向到一个·<code>ByteArrayOutputStream</code>中，对<code>ByteArrayOutputStream</code>进行解析，解析到需要的异常，直接处理掉异常；但是由此也引发一个问题，<code>System.err</code>被定向到<code>ByteArrayOutputStream</code>后，控制台将不会再打印错误信息，因此需要寻求一种方案，将<code>System.err</code>同时定向到<code>ByteArrayOutputStream</code>和<code>System.err</code>控制台本身。以下是部分实现逻辑。</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sanly.niu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FilterOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 一个流多个输出</span><br><span class="line"> * </span><br><span class="line"> * 应用场景： 既写入文件流，又写到控制台流</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> sanly</span><br><span class="line"> * <span class="doctag">@create</span> date 2015年5月18日</span><br><span class="line"> * </span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MutiOutputStream</span> <span class="keyword">extends</span> <span class="title">FilterOutputStream</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> OutputStream out2;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MutiOutputStream</span><span class="params">(OutputStream out1, OutputStream out2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(out1);</span><br><span class="line">		<span class="keyword">this</span>.out2 = out2;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">int</span> b)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.write(b);</span><br><span class="line">		out2.write(b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] b)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.write(b);</span><br><span class="line">		out2.write(b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.write(b, off, len);</span><br><span class="line">		out2.write(b, off, len);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.flush();</span><br><span class="line">		out2.flush();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.close();</span><br><span class="line">		out2.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-Java利器之-native加载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/07/Java利器之-native加载/" class="article-date">
  	<time datetime="2015-06-07T05:22:06.000Z" itemprop="datePublished">2015-06-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/07/Java利器之-native加载/">Java利器之-native加载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>Java项目中有时候会涉及到一些第三方native调用，加载动态链接库(.dll、.so)文件经常会遇到一些错误，如无法加载，如何解决这个问题呢？</p>
<hr>
<ol>
<li>通过JVM启动参数设定<code>java -Djava.library.path=c：/naitve</code></li>
<li>在代码中设定<code>System.setProperty(&quot;java.library.path&quot;, &quot;c:/native&quot;);</code>(<font color="red">错误</font>);</li>
<li>利用反射机制注入库路劲，调用编写好的类<code>ClassPathTool.addToClassPath(&quot;c:/native&quot;)</code>实现。</li>
</ol>
<hr>
<ul>
<li>第一种方式是可以正确设置库文件加载路径的，程序能够正常运行；</li>
<li>第二种方式是不行的，java.library.path只有在JVM启动时候读取一次，因此使用第二种方式无法生效；</li>
<li>第三种方式通过反射机制注入库路径，能按照我的想法正常运行，以下是如何实现。</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ClassPathTool</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	public <span class="literal">static</span> <span class="keyword">void</span> addToClassPath(File classPathFile) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Field field = ClassLoader.<span class="keyword">class</span>.getDeclaredField(<span class="string">"usr_paths"</span>);</span><br><span class="line">			field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">Object</span> obj = field.<span class="literal">get</span>(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; list = <span class="keyword">new</span> ArrayList&lt;<span class="built_in">String</span>&gt;(Arrays.asList(((<span class="built_in">String</span>[]) obj)));</span><br><span class="line">			list.add(classPathFile.getAbsolutePath());</span><br><span class="line">			<span class="keyword">for</span>(File f : classPathFile.listFiles()) &#123;</span><br><span class="line">				list.add(f.getAbsolutePath());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">String</span>[] arr = <span class="keyword">new</span> <span class="built_in">String</span>[<span class="number">0</span>];</span><br><span class="line">			field.<span class="literal">set</span>(<span class="keyword">null</span>, (<span class="built_in">String</span>[]) list.toArray(arr));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-如何查看windows文件-文件夹占用进程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/06/如何查看windows文件-文件夹占用进程/" class="article-date">
  	<time datetime="2015-06-06T07:12:31.000Z" itemprop="datePublished">2015-06-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/06/如何查看windows文件-文件夹占用进程/">如何查看windows文件/文件夹占用进程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>很多情况下，我会遇到在删除windows系统下某个文件或文件夹时，系统提示我该文件或文件夹被其它进程占用，从而无法删除该文件。也许你会尝试安装一些其它辅助软件（比如<span style="color:red">流氓360软件、XX卸载大师</span>），反正我觉得这个实在是太重量级了，况且我根本不想安装这些XX软件。那么到底还有没有其它更加方便的方法可以让我找到是哪一个进程占用了该文件呢？</p>
<blockquote>
<ol>
<li>右键 - Windows 7任务栏 - 启动任务管理器 - 性能 - 资源监视器；</li>
<li>在控制台中点击“CPU”标签定位到该标签页下；</li>
<li>在“关联的句柄”右侧的搜索框中输入“test”，此时系统会自动搜索与test句柄相关联的系统进程；</li>
<li>可以看到搜索到的进程为cmd.exe。cmd.exe进程正在调用test文件夹，才造成了对该文件夹删除的失败。右键单击该进程，然后选择“结束进程”命令弹出警告对话框，确认后即可结束cmd.exe进程。最后，删除test文件夹，可以看到该文件夹被成功删除。</li>
</ol>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-利用hexo、markdown、git在github上建立自己的博客" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/05/利用hexo、markdown、git在github上建立自己的博客/" class="article-date">
  	<time datetime="2015-06-05T07:26:01.000Z" itemprop="datePublished">2015-06-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/05/利用hexo、markdown、git在github上建立自己的博客/">利用hexo、markdown、git在github上建立自己的博客</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>搭建个人博客的方式其实有很多种，尤其是对于程序员而言甚至可以自己写一套博客程序，可以选择的平台其实也非常多，著名的WordPress就是一个，我曾经在大学期间倒腾过WordPress，WordPress是一个很优秀、具有大量用户但也十分臃肿的系统，不仅需要关注写作，还需要倒腾各种五花八门的插件、管理维护MySQL数据库，总之来言对于经历有限的我而言，我选择放弃。直到最近又萌生了写博客的想法，选择了程序员中使用最为流行的github pages服务来提供个人博客支持，倒腾过WordPress之后遇到它，我不得不说使用起来非常方便。</p>
<hr>
<h6 id="介绍一下Windows平台搭建环境使用到的工具：">介绍一下Windows平台搭建环境使用到的工具：</h6><ul>
<li>TortoiseGit （版本控制软件，用途： 检出、提交代码）</li>
<li>MarkdwownPad2  （写作软件， 用途： 一种类似html语法的编辑器、主要用于写作、排版）</li>
<li>nodejs （服务器端的JavaScript编译、运行环境， 用途： 编译、运行node程序）</li>
<li>hexo （一款node程序，用途：基于主题编译markdown生成html、支持发布到github）</li>
</ul>
<hr>
<h6 id="个人使用习惯">个人使用习惯</h6><ol>
<li>cmd&gt; hexo new 文章名称 （创建一篇新文章）</li>
<li>利用MarkdwownPad2编辑创建的新文章 （开始写作）</li>
<li>cmd&gt; hexo g  （编译markdwon生成html)</li>
<li>cmd&gt; hexo d  （部署生成的html）</li>
<li>cmd&gt; hexo s  （启动服务器，访问<a href="http://127.0.0.1:4000查看实时变更）" target="_blank" rel="external">http://127.0.0.1:4000查看实时变更）</a></li>
<li>cmd&gt; git push （将生成的html推送到github）</li>
<li>访问<a href="https://itsuifeng.github.io">https://itsuifeng.github.io</a> </li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/">github</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Sanly
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>